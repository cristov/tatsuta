{@
	$mi = $module_info;
	if (!$mi->thumbnail_width)  $mi->thumbnail_width  = 130;
	if (!$mi->thumbnail_height) $mi->thumbnail_height = 100;
	
	$mi->thumbnail_type = 'ratio';

	$slider_js = json_encode($document_list);

	$thumb_list = getThumbnailList();
	$thumb_js = json_encode($thumb_list);
}
<load target="webcatalog.css" />
<load target="js/jquery.elevatezoom.js" />
<load target="js/jquery.ad-gallery.js" />
<load target="http://code.jquery.com/ui/1.10.3/jquery-ui.js" />
<load target="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />

<?php
function getThumbnailList() {
	$oDocumentModel = &getModel('document');
	$output = $oDocumentModel->getDocumentList($args, true);
	$result;

	foreach ($output->data as $doc) {
		$document_srl = $doc->document_srl;
		$oDocument = $oDocumentModel->getDocument($document_srl);
		$thumbnail = $oDocument->getThumbnail(130, 100, 'ratio');
		$result[$document_srl] = $thumbnail;
	}

	return $result;
}
?>

<script type="text/javascript">
/* 
FullScreen JavaScript API
-------------
Assumes Mozilla naming conventions instead of W3C for now
*/
(function() {
	var fullScreenApi = { 
		supportsFullScreen: false,
		isFullScreen: function() { return false; }, 
		requestFullScreen: function() {}, 
		cancelFullScreen: function() {},
		fullScreenEventName: '',
		prefix: ''
	},
	browserPrefixes = 'webkit moz o ms khtml'.split(' ');
	
	// check for native support
	if (typeof document.cancelFullScreen != 'undefined') {
		fullScreenApi.supportsFullScreen = true;
	} else {	 
	// check for fullscreen support by vendor prefix
		for (var i = 0, il = browserPrefixes.length; i < il; i++ ) {
			fullScreenApi.prefix = browserPrefixes[i];
		 
			if (typeof document[fullScreenApi.prefix + 'CancelFullScreen' ] != 'undefined' ) {
				fullScreenApi.supportsFullScreen = true;
			 
				break;
			}
		}
	}

	// update methods to do something useful
	if (fullScreenApi.supportsFullScreen) {
		fullScreenApi.fullScreenEventName = fullScreenApi.prefix + 'fullscreenchange';

		fullScreenApi.isFullScreen = function() {
			switch (this.prefix) {	
				case '':
					return document.fullScreen;
				case 'webkit':
					return document.webkitIsFullScreen;
				default:
					return document[this.prefix + 'FullScreen'];
			}
		}
		fullScreenApi.requestFullScreen = function(el) {
			return (this.prefix === '') ? el.requestFullScreen() : el[this.prefix + 'RequestFullScreen']();
		}
		fullScreenApi.cancelFullScreen = function(el) {
			return (this.prefix === '') ? document.cancelFullScreen() : document[this.prefix + 'CancelFullScreen']();
		}	

		// jQuery plugin
		if (typeof jQuery != 'undefined') {
			jQuery.fn.requestFullScreen = function() {

				return this.each(function() {
					var el = jQuery(this);
					if (fullScreenApi.supportsFullScreen) {
						fullScreenApi.requestFullScreen(el);
					}
				});
			};
		}

		// export api
		window.fullScreenApi = fullScreenApi;	
	}
})();

// slider section
var slider_arr = new Array();
var slider_js = {$slider_js};
for (var i in slider_js) {
	var doc = slider_js[i];
	slider_arr.unshift(doc.document_srl);
}
slider_arr.sort();
slider_arr.reverse();

// thumbnail list
var thumb_js = {$thumb_js};

jQuery(function($) {
	isZoomActive = false;
	zoom = new Object();
	enableZoom = function () {
		$('#cm-image img').css('display', 'none');
		$('#nav-screen').css('display', 'block');

		var cheight = _getImageContainerSize('cm-image').height;
		var cwidth = _getImageContainerSize('cm-image').width;

		zoom = $('#nav-screen-img');
		zoom.elevateZoom({zoomWindowPosition: "cm-image", zoomWindowHeight: cheight, zoomWindowWidth: cwidth, borderSize: 0});

		isZoomActive = true;
		return isZoomActive;
	};
	disableZoom = function () {
		var result = true;
		$('#cm-image img').css('display', 'block');
		$('#nav-screen').css('display', 'none');
		$('div.zoomLens').remove();
		$('div.zoomWindowContainer').remove();
		$('div.zoomContainer').remove();

		isZoomActive = false;
		return result;
	};
	resetZoom = function(){
		disableZoom();
		enableZoom();
	};

	function _getImageContainerSize(elementId) {
		var elem = $("#"+elementId);
		var elem_width = elem.width();
		var elem_height = elem.height();

		return {width: elem_width, height: elem_height};
	};

	clickTriger = function(obj) {
		var data = $(obj).attr('data');
		$('a#' + data).trigger('click');
	};

	initDialog = function() {
		$('#search_keyword').val('');
		$('#search_target option:eq(0)').attr('selected', 'selected');
		$('#sd-result').empty();
	};

	strip_tags = function(input, allowed) {
   	allowed = (((allowed || "") + "").toLowerCase().match(/<[a-z][a-z0-9]*>/g) || []).join(''); // making sure the allowed arg is a string containing only tags in lowercase (<a><b><c>)
   	var tags = /<\/?([a-z][a-z0-9]*)\b[^>]*>/gi, commentsAndPhpTags = /<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi;
   	return input.replace(commentsAndPhpTags, '').replace(tags, function ($0, $1) {
			return allowed.indexOf('<' + $1.toLowerCase() + '>') > -1 ? $0 : '';
   	});
	};

	function _setDomControlForMSIE() {
		if ($.browser.msie == true && $.browser.version == '7.0') {
			$('#cm-thumbs').hide();
			$('#cm-contents').hide();
		}
	};

	$(window).resize(function(){
		gallery.resize();
	});

	$(document).ready(function(){

		isZoomActive = false;

		gallery = $('#catalog-main').adGallery(); 

		_setDomControlForMSIE();

		$('#cct-page').click(function() {
			$('#cm-thumbs, .ad-back, .ad-forward').toggleClass('hide');
		});

		$('#cct-list').click(function() {
			$('#cm-contents').toggleClass('hide');
		});

		$('#cct-close').click(function() {
			$('#cm-thumbs, .ad-back, .ad-forward').addClass('hide');
			$('#cm-contents').addClass('hide');
		});

		$('#page-slider').slider({
			min: 0,
			max: slider_arr.length - 1,
			change: function( event, ui ) {
				var data = slider_arr[ui.value];
				$('a#' + data).trigger('click');
			},
			create: function( event, ui ) {
				var id = window.location.hash.replace(/^#ad-image-/g, '');
				var index = $.inArray(id, slider_arr);
				$(this).slider('option', 'value', index);
			}
		});

		$('span#pagecount').text('/ ' + slider_arr.length);

		$('#mw-fullscreen').click(function() {
			var elem = $('#catalog-main');
			window.fullScreenApi.requestFullScreen(elem);
		});

		$('#mw-zoomin').click(function() {
			if (!isZoomActive) {
				enableZoom();
			}
		});
		$('#mw-zoomout').click(function() {
			if (isZoomActive) {
				isZoomActive = false;
				disableZoom();
			}
		});
		$('span.cm-content-a').click(function() {
			clickTriger(this);
		});
		$('#mw-search').click(function() {
			$('#search-dialog').dialog({
				modal: true,
				draggable: false,
				resizable: false,
				title: '검색',
				width: 400,
				height: 100,
				position: {
					at: 'top'
				},
				open: function( event, ui ) {},
				close: function( event, ui ) {
					initDialog();
				}
			});
		});
		$('#sdf-button').click(function() {
			$('#sd-result').empty();

			var data = {
				'mid': '{$mid}',
				'search_keyword': $('#search_keyword').val(),
				'search_target': 'title_content',
				'act': 'dispBoardContentList'
			};
			$.ajax({
				type: 'POST',
				url: '{getUrl()}',
				data: data,
				contentType: 'application/json'
			}).done(function(resp) {
				$('.ui-dialog').animate({
					'width': '800px',
					'height': '100%',
					'max-height': '600px',
					'overflow-y': 'scroll'
				}, {
					'duration': 500,
					'step': function() {
						$('#search-dialog').dialog('option', 'position', 'top');
						$('#search-dialog').css('height', '90%');
					}
				});

				var oResult = $('#sd-result');
				var document_list = $.parseJSON(resp).document_list;
				if (document_list.length == 0) {
					oResult.append('검색결과가 없습니다.');
				} else {
					var oCell_title = $(document.createElement('div')).attr('class', 'cell_1 sd-result-head').append('제목');
					var oCell_image = $(document.createElement('div')).attr('class', 'cell_2 sd-result-head').append('미리보기');
					var oCell_content = $(document.createElement('div')).attr('class', 'cell_3 sd-result-head').append('내용');
					var oCell_thumbnale = new Image();
					var oClear = $(document.createElement('div')).attr('class', 'clear-both');
					oResult.append(oCell_title, oCell_image, oCell_content, oClear);

					for (var i in document_list) {
						var document_srl = document_list[i].document_srl;
						var title = document_list[i].title;
						var content = document_list[i].content;

						var oCell_1_attr = {};
						oCell_1_attr['class'] = 'cell_1 cm-content-a';
						oCell_1_attr['data'] = document_srl;
						var oCell_1 = $(document.createElement('span')).attr(oCell_1_attr).append(title).click(function() { clickTriger(this); $('#search-dialog').dialog('close'); });
						var oImage = $(new Image()).attr('src', thumb_js[document_srl]);
						var oCell_2 = $(document.createElement('div')).attr('class', 'cell_2').append(oImage);
						var oCell_3 = $(document.createElement('div')).attr('class', 'cell_3').append(strip_tags(content));
						var oClear_both = $(document.createElement('div')).attr('class', 'clear-both');

						oResult.append(oCell_1, oCell_2, oCell_3, oClear_both);
					}
				}
			}).fail(function(msg) {
				console.log('Fail. ' + msg);
			});
		});
	});
});
</script>

	<div class="menu-wrapper">
		<div id="tatsuta"></div>
		<ul class="mw-sub">
			<li id="mw-pdfdown"><img src="img/btn_pdfdown.png"></li>
		</ul>
		<ul class="mw-sub">
			<li id="mw-mail" class="nav-btn"><img src="img/btn_mail.png"></li>
			<li id="mw-print" class="nav-btn"><img src="img/btn_print.png"></li>
			<li id="mw-size" class="nav-btn"><img src="img/btn_size.png"></li>
		</ul>
		<ul class="mw-sub">
			<li id="mw-start-page" class="nav-btn"><img src="img/btn_prev02.png"></li>
			<li id="mw-prev-page" class="nav-btn"><img src="img/btn_prev01.png"></li>
			<div id="mw-input-pagenum"><input type="text" name="pagenation" style="width:40px;"><span id="pagecount"></span></div>
			<li id="mw-go" class="nav-btn"><img src="img/btn_go.png"></li>
			<li id="mw-next-page" class="nav-btn"><img src="img/btn_next01.png"></li>
			<li id="mw-end-page" class="nav-btn"><img src="img/btn_next02.png"></li>
		</ul>
		<ul class="mw-sub">
			<li id="mw-zoomin" class="nav-btn"><img src="img/btn_zoomin.png"></li>
			<li id="mw-zoomout" class="nav-btn"><img src="img/btn_zoomout.png"></li>
		</ul>
		<ul class="mw-sub">
			<li id="mw-listscreen" class="nav-btn"><img src="img/btn_listscreen.png"></li>
			<li id="mw-fullscreen" class="nav-btn"><img src="img/btn_fullscreen.png"></li>
		</ul>
		<ul class="mw-sub">
			<li id="mw-search" class="nav-btn"><img src="img/btn_search.png"></li>
		</ul>
		<div class="clear"></div>
	</div>

	<div id="page-slider">
		<img id="ps-left" src="img/slide_button01.png" width="22" height="20">
		<img id="ps-right" src="img/slide_button02.png">
		<div class="clear"></div>
	</div>

	<div id="catalog-main">
		<div id="cm-image-wrapper">&nbsp;</div>
		<div id="catalog-table-contents">
			<div id="cm-thumbs" class="hide">
				<ul id="cm-thumb-list">
					<li class="clearfix" loop="$document_list=>$doc">
						<a href="{$doc->getThumbSourceFile()}" id="{$doc->document_srl}">
							<img src="{$doc->getThumbnail($mi->thumbnail_width, $mi->thumbnail_height, $mi->thumbnail_type)}" />
						</a>
					</li>
				</ul>
			</div>
			<div id="cm-contents" class="hide">
				<ul id="cm-content-list">
					<li class="clearfix" loop="$notice_list=>$no,$document">
						<span class="cm-content-a" data="{$no}">
							{$document->getTitle($module_info->subject_cut_size)}
						</span>
					</li>
				</ul>
			</div>
			<div id="catalog-content-tab">
				<img id="cct-page" src="img/tab01.png">
				<img id="cct-list" src="img/tab02.png">
				<img id="cct-close" src="img/tab03.png">
			</div>
		</div>
		<div class="clear"></div>

		<div id="nav-screen" style="z-index:9999">
			<img id="nav-screen-img">
		</div>
	</div>

	<div id="search-dialog">
		<div id="sd-form">
			<input type="text" id="search_keyword" value="{htmlspecialchars($search_keyword)}" title="{$lang->cmd_search}" class="iText" />
			<button id="sdf-button" class="btn" type="button">{$lang->cmd_search}</button>
		</div>
		<div id="sd-result"></div>
	</div>
